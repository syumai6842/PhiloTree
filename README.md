# 📘 思想ツリー対話アプリ 要件定義書

## 🧭 概要

PhiloTreeは、思想を視覚的に整理し、批評と統合を通じて深い思考を促進するアプリです。MyGPTsとの統合により、AIとの対話を通じて思想ツリーを自動的に構築できます。

### 🔄 思考フロー

1. ユーザーが「考えたいこと」「気になっていること」をノードとして登録（体系に接続されたもの／されていないもの両方）
2. 日常的にツリー上に思索の種を蓄積
3. ユーザーがGPTsと通話（暇な時など）
4. GPTsが思想体系全体を読み込み、様々な学問領域（哲学・心理・社会など）から学者的視座で応答（批判・共鳴・接続）
5. 対話の中で思想がアウフヘーベン（統合・昇華）され、新たなノードとしてマップに組み込まれる
6. 統合されたノードには、どの学者のどの視座と統合されたかが明記され、思想履歴としてGitHubのように可視化される

## 🎨 UI要件

### 🎯 テーマとコンセプト

* 本アプリは赤×黒ベースの**専用ダークモードUI**で統一される。
* ユーザーの思想体系を**視覚的マップとして操作・構築できる体験**を重視し、タッチ・ドラッグによる直感的な操作性を追求する。
* 批評・統合・棄却といった思想の動的変化を、ノードと並列な視座ブランチで表現する。

### 📱 Expoアプリの主要画面とインタフェース構成（改訂）

| 画面          | 要素                | UI仕様                                                                                                                   |                                                                                |
| ----------- | ----------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| 思想マップ画面     | ノードの視覚的配置・接続      | ノードはキャンバス上の自由配置式。長押しでノード追加。既存ノードへの接続は視覚的インジケータ（矢印候補）から選択する方式で簡易化。関係線は枝分かれ・重なりにも対応し、ジャンル・重要度で色分け。                       |                                                                                |
| ノード作成ポップアップ | タイトル、本文、接続先ノードの選択 | マインドマップ形式を踏襲し、既存ノードをタップ後「＋」ボタンで即座に子ノード作成が可能。さらに、関係線（ブランチ）をタップし「＋」ボタンを押すことで、ノードとノードの間にも中間ノードを挿入できる。親・子の接続関係は自動的に再構成される。 | マインドマップ形式を踏襲し、既存ノードをタップ後「＋」ボタンで即座に子ノード作成が可能。親子関係はワンタップで自動設定され、テキスト入力後すぐに追加される。 |
| ノード詳細表示     | タイトル、要約、批評、統合履歴   | 画面内にポップアップではなく**埋め込み小ウィンドウ**として開く。マップ上に重ならずに閲覧・編集可能。関連批評も統合元／棄却元と視覚リンク。                                                |                                                                                |
| 哲学視座ブランチ表示  | GPTからの批評、共鳴、統合・棄却 | ノードと**並列構造**で思想批評がブランチとして表示される。統合ノードは枝分かれの先に生成され、元ノードとの関係が明確に可視化される。批評・反論・統合のフローが一目で分かるように、色分けされた流れを持つ矢印で接続される。        |                                                                                |
| 通話準備画面      | 通話対象ノード選択／GPT接続状態 | 通話候補ノード一覧。チェックボックス付きリストで選択し、GPTとのVoice接続ステータスも同時に表示。                                                                   |                                                                                |

### その他UI仕様

* 赤×黒の**専用ダークテーマ（常時適用）**：

  * 背景：#0A0A0A
  * ノード通常色：#AA0000、選択時：#FF3333、批評：#660000
  * 文字色：#EEEEEE、関係線：赤系グラデーション

* 思想マップ画面はCanvasベース＋GPU描画最適化

* ノード操作はすべてドラッグ・長押し・ピンチズーム対応

* 小画面ノード詳細ビューはアニメーション付きスライドイン／アウト

* ダークモード対応

* 思索に集中しやすいミニマルUI（余白と階層的視認性重視）

* モバイル端末の片手操作を想定したFAB配置とレスポンシブ設計

* 思想ツリー画面はCanvasベースでパフォーマンス最適化

---

## 🔁 システム構成

```
[ユーザー発話] ⇄ [MyGPTs (PhiloTree)] ⇄ [アプリAPIエンドポイント] ⇄ [Expoアプリで可視化]
```

---

## 🛠️ 機能要件

### 📱 Expoアプリ側（思想ツリー可視化＆入力）

#### 機能一覧（詳細）

| 機能              | 詳細内容                                                                                   |
| --------------- | -------------------------------------------------------------------------------------- |
| ノード追加           | ユーザーが自由入力した問い・命題・経験・概念を1つのノードとして追加。プレースホルダに「最近気になることを自由に書いてください」。保存時にIDとタイムスタンプが付与される。 |
| ノードの親子構造化       | 新規ノードを独立した概念として保存するか、既存ノードの子として接続できる。選択された親ノードと階層的に接続され、ツリー上に関係性が反映される。                |
| ノードメタデータ付与      | 各ノードには、カテゴリ（倫理・存在・認識など）、参考文献、出典、重要度（1〜5）などの属性を設定できる。                                   |
| 通話タグ付け（メンション対象） | 「通話で扱いたい」とユーザーが指定したノードは `isMentionTarget = true` としてフラグされ、GPTが通話時に取得する対象となる。           |
| ノード可視化          | 思想体系を有向グラフ（DAG）構造で描画。ノードの色・形・太さで重要度やジャンルを区別。SVGベースでズーム、ドラッグ、折りたたみ可能。                   |
| ノード編集・削除        | 既存ノードのタイトル・内容・関係性・メタデータを編集。誤操作防止の確認つき削除機能あり。                                           |
| リアルタイム更新        | GPTs通話中に生成された新規ノード・接続情報を即時でツリーに反映。WebSocket or Firebaseベースで常時監視。                       |
| アウフヘーベン履歴表示     | GPTが生成した「統合ノード」には、元になった複数のノード・批評者（例：ハイデガー×サルトル）を明示。履歴はGitHubのコミットのように可視化される。           |

---

### 🧠 MyGPTs（PhiloTree）側（思想生成・批評・応答）

#### 機能一覧（詳細）

| 機能            | 詳細内容                                                                                      |
| ------------- | ----------------------------------------------------------------------------------------- |
| ユーザー発話からノード構成 | 会話中の自然発話から、意味単位（命題・疑問・定義）を抽出し、自動でノード化。必要に応じて親ノードとの関係性も付与し、APIで送信。                         |
| 哲学的視座からの批評生成  | GPTはノードの意味解析結果から、関連する学者・理論・学問分野を選定し、該当視座からの批判・接続・補足・統合の応答を生成。複数視座の比較も可能。                  |
| 通話メンション対応     | ユーザーが「〜について考えたい」と述べた際、ノードタイトルと照合し、事前に通話対象としてフラグされたノード（isMentionTarget）を対象に応答を生成。          |
| 思想体系構造の全体参照   | GPTは対話前に思想ノード全体の構造を取得・保持し、ノード間の関係性・ギャップ・未接続領域を文脈的に判断する。                                   |
| 統合ノードの生成と送信   | 複数の既存ノードと哲学的視座から導き出された共通思想を「統合ノード（アウフヘーベン）」として新規作成し、参照元と視座名を含めた状態でAPIに送信。                 |
| エンドポイント呼び出し   | Expoアプリに対して `POST /receive-node` によるノード送信、`GET /nodes` による参照、`GET /nodes/:id` による個別取得を行う。 |

## 🎙️ 通話体験イメージ

* ユーザー「最近、"なぜ他者の期待に応えたくなるのか？"が気になってて…」
* GPT（ノードリストからマッチ）→ 該当ノード取得 → 哲学者視座応答

> GPT「それはフロイト的には超自我の内面化とも…レヴィナスなら"顔"の呼びかけですね」

---

## 主な機能

### 思想マップ
- 思想ノードの作成・編集・削除
- ノード間の関係性の視覚化
- ズーム・パン機能による直感的な操作
- カテゴリ別の色分け表示

### 批評システム
- 既存の思想に対する批評の追加
- 複数の視点からの批評表示
- 批評の種類別分類

### 統合機能
- 複数の思想と批評を統合した新しいノードの作成
- 統合プロセスの履歴管理
- 統合の視点の記録

### MyGPTs統合
- MyGPTsからの自動ノード作成
- リアルタイム同期
- WebSocketによる即座の反映

## 技術スタック

- **フロントエンド**: React Native (Expo)
- **バックエンド**: Supabase
- **リアルタイム通信**: Supabase Realtime
- **データベース**: PostgreSQL
- **認証**: Supabase Auth
- **ストレージ**: AsyncStorage (ローカル)

## セットアップ

### 前提条件
- Node.js 18以上
- Expo CLI
- Supabaseアカウント

### インストール

1. リポジトリをクローン
```bash
git clone <repository-url>
cd PhiloTree
```

2. 依存関係をインストール
```bash
npm install
```

3. 環境変数を設定
```bash
# .env.local ファイルを作成
EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

4. Supabaseプロジェクトを設定
   - [MyGPTs統合ガイド](./docs/mygpts-integration.md)を参照

5. アプリを起動
```bash
npm start
```

## 使用方法

### 基本的な操作
1. **ノード作成**: 画面右下の「+」ボタンをタップ
2. **ノード編集**: ノードを長押し
3. **ノード詳細**: ノードをタップ
4. **批評追加**: ノード詳細画面から批評を追加
5. **統合作成**: 複数のノードを選択して統合

### MyGPTsとの連携
1. Supabase Edge Functionsをデプロイ
2. MyGPTsでエンドポイントを設定
3. 対話を通じて自動的にノードが作成される

## プロジェクト構造

```
PhiloTree/
├── app/                    # Expo Router ページ
├── components/             # 再利用可能コンポーネント
├── contexts/              # React Context
├── constants/             # 定数定義
├── hooks/                 # カスタムフック
├── lib/                   # ライブラリ設定
├── types/                 # TypeScript型定義
├── docs/                  # ドキュメント
└── supabase/              # Supabase設定
```

## 開発

### 開発サーバー起動
```bash
npm start
```

### ビルド
```bash
# iOS
npm run ios

# Android
npm run android

# Web
npm run web
```

### リント
```bash
npm run lint
```

## デプロイ

### Expo EAS Build
```bash
# EAS CLIをインストール
npm install -g @expo/eas-cli

# ビルド設定
eas build:configure

# ビルド実行
eas build --platform ios
eas build --platform android
```

## 貢献

1. フォークを作成
2. フィーチャーブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題や質問がある場合は、GitHubのIssuesページでお知らせください。

## 更新履歴

### v1.0.0
- 初期リリース
- 思想マップ機能
- 批評システム
- 統合機能
- MyGPTs統合
- リアルタイム同期

---


SubaBase SQLスキーマ
CREATE TABLE public.criticisms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  node_id uuid,
  scholar_name text NOT NULL,
  field text,
  comment text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  source_url text,
  CONSTRAINT criticisms_pkey PRIMARY KEY (id),
  CONSTRAINT criticisms_node_id_fkey FOREIGN KEY (node_id) REFERENCES public.nodes(id)
);
CREATE TABLE public.nodes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  content text,
  parent_ids ARRAY DEFAULT '{}'::uuid[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  source_gpt text,
  CONSTRAINT nodes_pkey PRIMARY KEY (id)
);